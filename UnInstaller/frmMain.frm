VERSION 5.00
Begin VB.Form frmMain 
   BackColor       =   &H80000005&
   BorderStyle     =   3  'Fixed Dialog
   Caption         =   "Homam AntiMalware removal"
   ClientHeight    =   2745
   ClientLeft      =   45
   ClientTop       =   435
   ClientWidth     =   3990
   BeginProperty Font 
      Name            =   "Tahoma"
      Size            =   8.25
      Charset         =   178
      Weight          =   400
      Underline       =   0   'False
      Italic          =   0   'False
      Strikethrough   =   0   'False
   EndProperty
   Icon            =   "frmMain.frx":0000
   LinkTopic       =   "Form1"
   LockControls    =   -1  'True
   MaxButton       =   0   'False
   ScaleHeight     =   2745
   ScaleWidth      =   3990
   StartUpPosition =   2  'CenterScreen
   Begin VB.PictureBox picArrow 
      Enabled         =   0   'False
      Height          =   375
      Left            =   120
      Picture         =   "frmMain.frx":000C
      ScaleHeight     =   315
      ScaleWidth      =   315
      TabIndex        =   11
      TabStop         =   0   'False
      Top             =   3360
      Width           =   375
   End
   Begin VB.PictureBox picWarn 
      Enabled         =   0   'False
      Height          =   375
      Left            =   1080
      Picture         =   "frmMain.frx":03C2
      ScaleHeight     =   315
      ScaleWidth      =   315
      TabIndex        =   9
      TabStop         =   0   'False
      Top             =   3360
      Width           =   375
   End
   Begin VB.PictureBox picOK 
      Enabled         =   0   'False
      Height          =   375
      Left            =   600
      Picture         =   "frmMain.frx":0778
      ScaleHeight     =   315
      ScaleWidth      =   315
      TabIndex        =   8
      TabStop         =   0   'False
      Top             =   3360
      Width           =   375
   End
   Begin VB.PictureBox picCommand 
      BorderStyle     =   0  'None
      Height          =   855
      Left            =   0
      ScaleHeight     =   855
      ScaleWidth      =   4455
      TabIndex        =   0
      TabStop         =   0   'False
      Top             =   2160
      Width           =   4455
      Begin VB.CheckBox chkRestart 
         Caption         =   "Restart the computer"
         Height          =   255
         Left            =   180
         TabIndex        =   2
         Top             =   180
         Visible         =   0   'False
         Width           =   1800
      End
      Begin VB.CommandButton cmdDelete 
         Caption         =   "Remove"
         Height          =   390
         Left            =   2160
         TabIndex        =   3
         Top             =   120
         Width           =   855
      End
      Begin VB.CommandButton cmdExit 
         Cancel          =   -1  'True
         Caption         =   "Exit"
         Default         =   -1  'True
         Height          =   390
         Left            =   3045
         TabIndex        =   1
         Top             =   120
         Width           =   855
      End
      Begin VB.Line Line2 
         BorderColor     =   &H80000014&
         X1              =   0
         X2              =   4440
         Y1              =   15
         Y2              =   15
      End
      Begin VB.Line Line1 
         BorderColor     =   &H80000010&
         X1              =   0
         X2              =   4440
         Y1              =   0
         Y2              =   0
      End
   End
   Begin VB.Label lblDone 
      Alignment       =   2  'Center
      AutoSize        =   -1  'True
      BackStyle       =   0  'Transparent
      Caption         =   "Program removed successfully"
      ForeColor       =   &H000000C0&
      Height          =   195
      Left            =   885
      TabIndex        =   10
      Top             =   1800
      Visible         =   0   'False
      Width           =   2205
   End
   Begin VB.Label lblJob1 
      BackStyle       =   0  'Transparent
      Caption         =   "- Ensuring program closure"
      Enabled         =   0   'False
      Height          =   255
      Left            =   1140
      TabIndex        =   7
      Top             =   840
      Width           =   3060
   End
   Begin VB.Image imgJob3 
      Height          =   255
      Left            =   855
      Top             =   1320
      Width           =   255
   End
   Begin VB.Image imgJob1 
      Height          =   255
      Left            =   855
      Top             =   840
      Width           =   255
   End
   Begin VB.Image imgJob2 
      Height          =   255
      Left            =   855
      Top             =   1080
      Width           =   255
   End
   Begin VB.Label lblJob3 
      BackStyle       =   0  'Transparent
      Caption         =   "- Resetting the registry"
      Enabled         =   0   'False
      Height          =   255
      Left            =   1140
      TabIndex        =   6
      Top             =   1320
      Width           =   3060
   End
   Begin VB.Label lblJob2 
      BackStyle       =   0  'Transparent
      Caption         =   "- Deleting program files"
      Enabled         =   0   'False
      Height          =   255
      Left            =   1140
      TabIndex        =   5
      Top             =   1080
      Width           =   3060
   End
   Begin VB.Label lblCurDoing 
      AutoSize        =   -1  'True
      BackStyle       =   0  'Transparent
      Caption         =   "Current action:"
      Enabled         =   0   'False
      Height          =   195
      Left            =   240
      TabIndex        =   4
      Top             =   240
      Width           =   1095
   End
End
Attribute VB_Name = "frmMain"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
'
' By Homam Babi - 2008
' humam_babi@hotmail.com
'
Option Explicit

Private Const IDS_EXE_NAME = 100
Private Const IDS_REG_APPNAME = 110
Private Const IDS_REG_SECTION_SETTINGS = 111
Private Const IDS_REG_KEY_INSTALLED = 112
Private Const IDS_REG_KEY_AUTODELETE = 113
Private Const IDS_REG_KEY_MSG_STYLE = 114
Private Const IDS_HAV_TITLE = 120
Private Const IDS_MSG_RESTART = 130
Private Const IDS_MSG_NOT_DELETED = 131

Private Declare Sub Sleep Lib "kernel32" (ByVal dwMilliseconds As Long)
Private Sub cmdDelete_Click()
    Dim WasDeleted As Boolean
    
    cmdDelete.Enabled = False
    cmdExit.Enabled = False
    
    lblCurDoing.Enabled = True
    lblJob1.Enabled = True
    lblJob1.FontBold = True
    imgJob1.Picture = picArrow.Picture
    DoEvents
    Sleep 500

DeleteEXE:
    If Delete(GetWindowsDir & LoadResString(IDS_EXE_NAME)) = False Then
        imgJob1.Picture = picWarn.Picture: DoEvents
        frmRun.Show vbModal, frmMain
        GoTo DeleteEXE
    End If
    imgJob1.Picture = picOK.Picture
    lblJob1.FontBold = False
    
    lblJob2.Enabled = True
    lblJob2.FontBold = True
    imgJob2.Picture = picArrow.Picture
    DoEvents
    Sleep 250
    'Already deleted !!
    
    WasDeleted = ScheduleDeletion()
    
    imgJob2.Picture = picOK.Picture
    lblJob2.FontBold = False
    
    lblJob3.Enabled = True
    lblJob3.FontBold = True
    imgJob3.Picture = picArrow.Picture
    DoEvents
    Sleep 500
    
    'Registry !!
    Dim strString As String
    
    'Autorun enabling
    fWriteValue "HKCU", "Software\Microsoft\Windows\CurrentVersion\Policies\Explorer", "NoDriveTypeAutoRun", "D", 145
    
    'App.Settings removal
    DelAppSettings
    
    'Windows Startup
    fDeleteValue "HKLM", "SOFTWARE\Microsoft\Windows\CurrentVersion\Run", LoadResString(IDS_HAV_TITLE)
    
    'Uninstall string removal
    fDeleteKey "HKLM", "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall", LoadResString(IDS_HAV_TITLE)
    
    lblJob3.FontBold = False
    imgJob3.Picture = picOK.Picture
    lblDone.Visible = True
    chkRestart.Visible = True
    chkRestart.Value = vbChecked
    
    If WasDeleted = False Then
        MsgBox LoadResString(IDS_MSG_NOT_DELETED), vbApplicationModal Or vbInformation Or vbOKOnly, LoadResString(IDS_UNHAV_TITLE)
    Else
        MsgBox LoadResString(IDS_MSG_RESTART), vbApplicationModal Or vbInformation Or vbOKOnly, LoadResString(IDS_UNHAV_TITLE)
    End If
    
    cmdExit.Enabled = True
End Sub
Private Sub cmdExit_Click()
    If chkRestart.Value = vbChecked Then
        Shell "shutdown -r -t 0"
        DoEvents
    End If
    End
End Sub
Private Sub Form_Load()
    SetIcon Me.hwnd, "AAA", True
End Sub
Private Sub DelAppSettings()
    On Error Resume Next
    
    DeleteSetting LoadResString(IDS_REG_APPNAME), LoadResString(IDS_REG_SECTION_SETTINGS), LoadResString(IDS_REG_KEY_AUTODELETE)
    DeleteSetting LoadResString(IDS_REG_APPNAME), LoadResString(IDS_REG_SECTION_SETTINGS), LoadResString(IDS_REG_KEY_INSTALLED)
    DeleteSetting LoadResString(IDS_REG_APPNAME), LoadResString(IDS_REG_SECTION_SETTINGS), LoadResString(IDS_REG_KEY_MSG_STYLE)
End Sub
